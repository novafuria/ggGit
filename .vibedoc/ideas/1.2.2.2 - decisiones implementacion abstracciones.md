# Decisiones: Implementación de Abstracciones

## Contexto
Este zettel documenta las decisiones consensuadas para la implementación de abstracciones basadas en el análisis de la idea [1.2.2 - implementacion de abstracciones](1.2.2 - implementacion de abstracciones.md).

## Decisiones Técnicas

### 1. Validación de Esquemas YAML
**Decisión:** Usar PyYAML + jsonschema
- **PyYAML** para cargar archivos YAML
- **jsonschema** para validar contra esquemas en `config/`
- Mantener esquemas existentes en `config-schema.yaml` y `commit-schema.yaml`

### 2. Integración con Git
**Decisión:** Usar subprocess (no GitPython)
**Justificación:**
- Mantiene compatibilidad con mensajes de error originales de Git
- Sin dependencias adicionales
- Control total sobre la ejecución
- Consistente con la filosofía de ggGit original

**Manejo de errores:**
- Capturar stderr y stdout de subprocess
- Preservar mensajes de error originales de Git
- Mapear códigos de salida a códigos de error estándar de ggGit

### 3. Framework de Testing
**Decisión:** pytest + TDD
- **pytest** como framework principal
- Integración con GitHub Actions
- Implementar TDD para nuevas funcionalidades
- Cobertura de código objetivo: 80%

### 4. Resolución de Inconsistencias Arquitectónicas

#### 4.1 Unificación de Sistema de Colores
**Problema:** Duplicación entre CLIBase, ColorManager y uso directo de Click
**Decisión:** 
- Mantener solo `ColorManager` con métodos estáticos
- Eliminar `CLIBase` (redundante)
- Refactorizar comandos para usar `ColorManager`

#### 4.2 Integración Real de Abstracciones
**Problema:** Las abstracciones existen pero no se usan
**Decisión:**
- Implementar funcionalidad real en todas las abstracciones
- Refactorizar comandos para usar `BaseCommand` correctamente
- Implementar logging real con `LoggingManager`

#### 4.3 Patrón de Inicialización
**Problema:** Comandos instancian componentes individualmente
**Decisión:**
- Usar `BaseCommand` como base para todos los comandos
- Centralizar inicialización en `BaseCommand.__init__()`
- Comandos específicos solo implementan `execute()`

## Estrategia de Implementación

### Fase 1: Corrección de Inconsistencias (1 semana)
1. **Unificar sistema de colores:**
   - Eliminar `CLIBase`
   - Refactorizar comandos para usar `ColorManager`
   - Actualizar `BaseCommand`

2. **Implementar abstracciones básicas:**
   - `ConfigManager` con carga real de YAML
   - `GitInterface` con operaciones básicas de subprocess
   - `LoggingManager` integrado en `BaseCommand`

### Fase 2: Implementación Funcional (2 semanas)
1. **Configuración jerárquica:**
   - Implementar carga de archivos YAML
   - Validación con jsonschema
   - Manejo de errores de configuración

2. **Operaciones Git:**
   - Implementar comandos Git básicos con subprocess
   - Manejo de errores preservando mensajes originales
   - Validaciones de repositorio

3. **Comandos base funcionales:**
   - `CommitCommand` con implementación real
   - `ConfigCommand` con operaciones CRUD
   - Integración con logging

### Fase 3: Testing y Refinamiento (1 semana)
1. **Tests unitarios:**
   - Framework pytest configurado
   - Tests para todas las abstracciones
   - GitHub Actions para CI/CD

2. **Refactoring de comandos:**
   - Migrar comandos a usar `BaseCommand`
   - Eliminar código duplicado
   - Implementar logging real

## Criterios de Éxito

### Funcionales
- [ ] Todos los comandos usan las abstracciones correctamente
- [ ] Configuración jerárquica funcional
- [ ] Operaciones Git con manejo de errores apropiado
- [ ] Logging centralizado funcionando

### Técnicos
- [ ] 80% cobertura de tests
- [ ] Sin código duplicado entre comandos
- [ ] Mensajes de error consistentes con Git original
- [ ] Performance aceptable (< 100ms por comando)

### Arquitecturales
- [ ] Separación clara de responsabilidades
- [ ] Abstracciones reutilizables
- [ ] Patrón de inicialización consistente
- [ ] Documentación actualizada

## Próximos Pasos

1. **Aprobar decisiones** con el equipo
2. **Crear planificación detallada** en carpeta `planning/`
3. **Implementar Fase 1** - Corrección de inconsistencias
4. **Seguir metodología TDD** para nuevas funcionalidades
5. **Integrar con GitHub Actions** para CI/CD

## Consideraciones Adicionales

### Dependencias
- Agregar `jsonschema` a `environment.yml`
- Mantener `PyYAML` como dependencia principal
- No agregar `GitPython` (usar subprocess)

### Compatibilidad
- Preservar comportamiento de ggGit original
- Mantener mensajes de error familiares para usuarios
- Asegurar compatibilidad con scripts existentes

### Mantenibilidad
- Documentar patrones de uso de abstracciones
- Crear ejemplos de implementación de comandos
- Establecer guías de contribución claras
